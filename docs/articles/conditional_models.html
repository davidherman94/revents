<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="revents">
<title>06. Conditional models in recurrent events • revents</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="06. Conditional models in recurrent events">
<meta property="og:description" content="revents">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">revents</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Vignettes</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://gitlab.par.quinten.io/d.herman/revents">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>06. Conditional models in recurrent events</h1>
                        <h4 data-toc-skip class="author">David
Herman</h4>
            
      
      
      <div class="d-none name"><code>conditional_models.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>warning <span class="op">=</span> <span class="cn">FALSE</span>, message <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tbalan/frailtyEM" class="external-link">frailtyEM</a></span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load data layout corresponding to the third layout</span></span>
<span><span class="va">file_path_data_csv</span> <span class="op">&lt;-</span> <span class="st">"C:/Users/david/revents/inst/data_layout_1.csv"</span></span>
<span></span>
<span><span class="va">data_layout_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">file_path_data_csv</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="cox-proportional-hazard-model-coxph">
<strong>Cox proportional hazard model (CoxPH)</strong><a class="anchor" aria-label="anchor" href="#cox-proportional-hazard-model-coxph"></a>
</h4>
<p>In time to first event analyses (i.e. classical cox regression), the
risk set is only restricted to first event of relapses. Thus, when
working with recurrent event data, this risk set is specified by using
the subset of SEVENT == 1.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cox.relapses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">TSTART</span>, <span class="va">TSTOP</span>, <span class="va">STATUS</span><span class="op">)</span> <span class="op">~</span> <span class="va">DISEASE_COURSE</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> </span>
<span>                      <span class="op">+</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">TIME_SINCE_DIAGNOSIS</span>, ties <span class="op">=</span> <span class="st">"breslow"</span>, </span>
<span>                      data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">data_layout_1</span>, <span class="va">SEVENT</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cox.relapses</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(TSTART, TSTOP, STATUS) ~ DISEASE_COURSE + </span></span>
<span><span class="co">#&gt;     AGE + SEX + RACE + TIME_SINCE_DIAGNOSIS, data = subset(data_layout_1, </span></span>
<span><span class="co">#&gt;     SEVENT == 1), ties = "breslow")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                            coef  exp(coef)   se(coef)      z        p</span></span>
<span><span class="co">#&gt; DISEASE_COURSESPMS   -0.5065415  0.6025760  0.1169950 -4.330 1.49e-05</span></span>
<span><span class="co">#&gt; AGE                   0.0001745  1.0001746  0.0045354  0.038   0.9693</span></span>
<span><span class="co">#&gt; SEXMale               0.1992437  1.2204793  0.0883283  2.256   0.0241</span></span>
<span><span class="co">#&gt; RACEWhite            -0.1131750  0.8929943  0.1414812 -0.800   0.4238</span></span>
<span><span class="co">#&gt; TIME_SINCE_DIAGNOSIS  0.0032136  1.0032188  0.0019227  1.671   0.0946</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test=33.5  on 5 df, p=2.997e-06</span></span>
<span><span class="co">#&gt; n= 1313, number of events= 565</span></span></code></pre></div>
<p>Here it can be seen that the CoxPH model gives an decreasing risk of
relapses of 40% in the SPMS group compared with the RRMS group. It is
important to consider that this model is ignoring all the other events
that precede the 1st events.</p>
<p>In order to account for them, we can use recurrent events models:</p>
</div>
<div class="section level4">
<h4 id="andersen-gill-ag-model">
<strong>ANDERSEN-GILL (AG) model</strong><a class="anchor" aria-label="anchor" href="#andersen-gill-ag-model"></a>
</h4>
<p>This is a classical cox extension model for recurrent event data
which assumes that events are independent and that the hazard ratio is
constant over time.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ag.relapses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">TSTART</span>, <span class="va">TSTOP</span>, <span class="va">STATUS</span><span class="op">)</span> <span class="op">~</span> <span class="va">DISEASE_COURSE</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span></span>
<span>                       <span class="va">SEX</span> <span class="op">+</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">TIME_SINCE_DIAGNOSIS</span>, data <span class="op">=</span> <span class="va">data_layout_1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ag.relapses</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span>exp <span class="op">=</span> <span class="cn">TRUE</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 7</span></span></span>
<span><span class="co">#&gt;   term                 estimate std.error statistic  p.value conf.low conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> DISEASE_COURSESPMS      0.564  0.040<span style="text-decoration: underline;">4</span>     -<span style="color: #BB0000;">14.2</span>   1.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-45</span>    0.522     0.611</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> AGE                     1.00   0.001<span style="text-decoration: underline;">52</span>      1.88  6.02<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>    1.00      1.01 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> SEXMale                 0.980  0.030<span style="text-decoration: underline;">5</span>      -<span style="color: #BB0000;">0.667</span> 5.05<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>    0.923     1.04 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> RACEWhite               1.12   0.052<span style="text-decoration: underline;">5</span>       2.11  3.47<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>    1.01      1.24 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> TIME_SINCE_DIAGNOSIS    1.00   0.000<span style="text-decoration: underline;">759</span>     1.50  1.35<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>    1.00      1.00</span></span></code></pre></div>
<p>Adjusting for covariates (in this case there are no time-dependent
covariates) and considering all events, the AG model shows that the risk
of relapse in the SPMS group is 44% lower than in the RRMS group.</p>
<p><em>It is important to mention that the AG model can also be fitted
with a robust = TRUE to take into account correlations among the events
and provides robust standard errors (not applied in this
example).</em></p>
</div>
<div class="section level4">
<h4 id="pwp-tt-or-ct-model-overall-effect">
<strong>PWP TT (or CT) model (overall effect)</strong><a class="anchor" aria-label="anchor" href="#pwp-tt-or-ct-model-overall-effect"></a>
</h4>
<p>The PWP model turns into a useful model when dependency between
events become relevant to account. This model add an <em>strata
term</em> to the model, which allows to account for the dependency
between events while obtaining the overall effect.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwp.tt.relapses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">TSTART</span>, <span class="va">TSTOP</span>, <span class="va">STATUS</span><span class="op">)</span> <span class="op">~</span> <span class="va">DISEASE_COURSE</span> <span class="op">+</span> </span>
<span>                           <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">TIME_SINCE_DIAGNOSIS</span> <span class="op">+</span> </span>
<span>                           <span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">STATUS</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data_layout_1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pwp.tt.relapses</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(TSTART, TSTOP, STATUS) ~ DISEASE_COURSE + </span></span>
<span><span class="co">#&gt;     AGE + SEX + RACE + TIME_SINCE_DIAGNOSIS + strata(STATUS), </span></span>
<span><span class="co">#&gt;     data = data_layout_1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                            coef  exp(coef)   se(coef)       z       p</span></span>
<span><span class="co">#&gt; DISEASE_COURSESPMS   -0.5459158  0.5793110  0.0401215 -13.607 &lt; 2e-16</span></span>
<span><span class="co">#&gt; AGE                   0.0028041  1.0028080  0.0015296   1.833 0.06678</span></span>
<span><span class="co">#&gt; SEXMale              -0.0427495  0.9581514  0.0305230  -1.401 0.16134</span></span>
<span><span class="co">#&gt; RACEWhite             0.1621498  1.1760364  0.0525550   3.085 0.00203</span></span>
<span><span class="co">#&gt; TIME_SINCE_DIAGNOSIS  0.0008012  1.0008015  0.0007341   1.091 0.27512</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test=272.3  on 5 df, p=&lt; 2.2e-16</span></span>
<span><span class="co">#&gt; n= 6347, number of events= 5092</span></span></code></pre></div>
<p>When analyses are performed based on restricted risk sets (the risk
set only involves those with the same number of previous events) with a
calendar time scale, the PWP gives a HR:0.57 for the SPMS group compared
with the RRMS group.</p>
</div>
<div class="section level4">
<h4 id="pwp-gt-model-overall-effect">
<strong>PWP GT model (overall effect)</strong><a class="anchor" aria-label="anchor" href="#pwp-gt-model-overall-effect"></a>
</h4>
<p>The PWP model can also be used to account for inter-event dependence
when the time scale is the gap time scale. This model is useful when the
time between events is of interest and there is a renewal after each
event (i.e. the participant returns to the previous state as, for
example, in diseases where the community does not develop after the
first event).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwp.gt.relapses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">TGAP</span>, <span class="va">STATUS</span><span class="op">)</span> <span class="op">~</span> <span class="va">DISEASE_COURSE</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span></span>
<span>                         <span class="op">+</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">TIME_SINCE_DIAGNOSIS</span> <span class="op">+</span></span>
<span>                           <span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">STATUS</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data_layout_1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pwp.gt.relapses</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(TGAP, STATUS) ~ DISEASE_COURSE + AGE + SEX + </span></span>
<span><span class="co">#&gt;     RACE + TIME_SINCE_DIAGNOSIS + strata(STATUS), data = data_layout_1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                            coef  exp(coef)   se(coef)       z       p</span></span>
<span><span class="co">#&gt; DISEASE_COURSESPMS   -0.5636383  0.5691346  0.0408425 -13.800 &lt; 2e-16</span></span>
<span><span class="co">#&gt; AGE                   0.0028712  1.0028754  0.0015265   1.881 0.05998</span></span>
<span><span class="co">#&gt; SEXMale              -0.0327096  0.9678196  0.0305313  -1.071 0.28401</span></span>
<span><span class="co">#&gt; RACEWhite             0.1422456  1.1528598  0.0526099   2.704 0.00686</span></span>
<span><span class="co">#&gt; TIME_SINCE_DIAGNOSIS  0.0011251  1.0011257  0.0007544   1.491 0.13586</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test=271.4  on 5 df, p=&lt; 2.2e-16</span></span>
<span><span class="co">#&gt; n= 6347, number of events= 5092</span></span></code></pre></div>
<p>When gap time scale is used, the PWP model gives a HR:0.56 for the
SPMS group compared with the RRMS group.</p>
</div>
<div class="section level4">
<h4 id="frailty-model">
<strong>Frailty model</strong><a class="anchor" aria-label="anchor" href="#frailty-model"></a>
</h4>
<p>The frailty model, introduces a random covariate or <em>frailty
term</em> into the model that induces dependence among the recurrent
event times.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">frailty.relapses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">TSTOP</span>, <span class="va">STATUS</span><span class="op">)</span> <span class="op">~</span> <span class="va">DISEASE_COURSE</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span></span>
<span>                          <span class="op">+</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">TIME_SINCE_DIAGNOSIS</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/frailty.html" class="external-link">frailty</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span>,</span>
<span>                          data <span class="op">=</span> <span class="va">data_layout_1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">frailty.relapses</span>, exp <span class="op">=</span> <span class="cn">TRUE</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   term                 estimate std.error statistic  p.value conf.low conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> DISEASE_COURSESPMS      0.774  0.040<span style="text-decoration: underline;">4</span>   40.0      2.57<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>    0.715     0.838</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> AGE                     1.00   0.001<span style="text-decoration: underline;">52</span>   0.156    6.93<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>    0.998     1.00 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> SEXMale                 0.999  0.030<span style="text-decoration: underline;">5</span>    0.000<span style="text-decoration: underline;">679</span> 9.79<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>    0.941     1.06 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> RACEWhite               1.01   0.052<span style="text-decoration: underline;">5</span>    0.043<span style="text-decoration: underline;">1</span>   8.35<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>    0.912     1.12 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> TIME_SINCE_DIAGNOSIS    1.00   0.000<span style="text-decoration: underline;">761</span>  2.17     1.40<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>    1.00      1.00 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> frailty(ID)            <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>         0.000<span style="text-decoration: underline;">620</span> 8.54<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>   <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>Conditional on the unmeasured heterogeneity and covariates, the
frailty model indicates that the SPMS group had a reducing risk of 23%
than the RRMS (HR: 0.77; 95% CI: 0.71, 0.83).</p>
<p>In order to verify if the use of frailty models is justified in our
study, it is possible to use the <em>emfrail</em> function from
<em>frailtyEM</em> package for getting the frailty variance or Kendall’s
tau. A variance close to 0 means no heterogeneity between patients.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">frailty_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/frailtyEM/man/emfrail.html" class="external-link">emfrail</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">TSTOP</span>, <span class="va">STATUS</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op">+</span> <span class="va">DISEASE_COURSE</span></span>
<span>                       <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">TIME_SINCE_DIAGNOSIS</span>, </span>
<span>                       data <span class="op">=</span> <span class="va">data_layout_1</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">frailty_var</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call: </span></span>
<span><span class="co">#&gt; emfrail(formula = Surv(TSTOP, STATUS) ~ cluster(ID) + DISEASE_COURSE + </span></span>
<span><span class="co">#&gt;     AGE + SEX + RACE + TIME_SINCE_DIAGNOSIS, data = data_layout_1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression coefficients:</span></span>
<span><span class="co">#&gt;                           coef exp(coef)  se(coef)         z    p</span></span>
<span><span class="co">#&gt; DISEASE_COURSESPMS   -0.255557  0.774485  0.040421 -6.322322 0.00</span></span>
<span><span class="co">#&gt; AGE                   0.000600  1.000600  0.001519  0.394967 0.69</span></span>
<span><span class="co">#&gt; SEXMale              -0.000795  0.999205  0.030528 -0.026038 0.98</span></span>
<span><span class="co">#&gt; RACEWhite             0.010910  1.010969  0.052527  0.207696 0.84</span></span>
<span><span class="co">#&gt; TIME_SINCE_DIAGNOSIS  0.001122  1.001123  0.000761  1.474168 0.14</span></span>
<span><span class="co">#&gt; Estimated distribution: gamma / left truncation: FALSE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit summary:</span></span>
<span><span class="co">#&gt; Commenges-Andersen test for heterogeneity: p-val  1.55e-145 </span></span>
<span><span class="co">#&gt; no-frailty Log-likelihood: -39801.63 </span></span>
<span><span class="co">#&gt; Log-likelihood: -39801.63 </span></span>
<span><span class="co">#&gt; LRT: 1/2 * pchisq(0), p-val&gt;0.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Frailty summary:</span></span>
<span><span class="co">#&gt;                    estimate lower 95% upper 95%</span></span>
<span><span class="co">#&gt; Var[Z]                 0.00     0.000     0.001</span></span>
<span><span class="co">#&gt; Kendall's tau          0.00     0.000     0.001</span></span>
<span><span class="co">#&gt; Median concordance     0.00     0.000     0.000</span></span>
<span><span class="co">#&gt; E[logZ]                0.00    -0.001     0.000</span></span>
<span><span class="co">#&gt; Var[logZ]              0.00     0.000     0.001</span></span>
<span><span class="co">#&gt; theta              38444.34   998.132       Inf</span></span>
<span><span class="co">#&gt; Confidence intervals based on the likelihood function</span></span></code></pre></div>
<p>In our example, there is no heterogeneity, so the use of frailty
models would not be justified. The differences detected in the frailty
model estimates with other conditional models may be due to model
assumptions rather than heterogeneity.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Herman, Quentin Pilard.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
