<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="revents">
<title>07. Marginal models in recurrent events • revents</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="07. Marginal models in recurrent events">
<meta property="og:description" content="revents">
<meta property="og:image" content="https://davidherman94.github.io/revents/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">revents</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Vignettes</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://gitlab.par.quinten.io/d.herman/revents">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>07. Marginal models in recurrent events</h1>
                        <h4 data-toc-skip class="author">David
Herman</h4>
            
      
      
      <div class="d-none name"><code>marginal_models.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>warning <span class="op">=</span> <span class="cn">FALSE</span>, message <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidherman94.github.io/revents/">revents</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></code></pre></div>
<p>In marginal models, dependency structures between times of recurring
events within a subject are not of interest. However, it can also be
partially specified as in this example, with several covariates but
without time-dependent covariates that may be of interest in conditional
models (i.e. symptoms that vary between events).</p>
<p>In marginal models, the data layout 2 is needed for LWA or WLW models
while data layout 1 continues being used for the marginal rates
models.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load data layout corresponding to the first and second data layout</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"data_layout_1"</span>, package <span class="op">=</span> <span class="st">"revents"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"data_layout_2"</span>, package <span class="op">=</span> <span class="st">"revents"</span><span class="op">)</span></span>
<span><span class="va">data_layout_1</span> <span class="op">&lt;-</span> <span class="fu">revents</span><span class="fu">::</span><span class="va"><a href="../reference/data_layout_1.html">data_layout_1</a></span></span>
<span><span class="va">data_layout_2</span> <span class="op">&lt;-</span> <span class="fu">revents</span><span class="fu">::</span><span class="va"><a href="../reference/data_layout_2.html">data_layout_2</a></span></span></code></pre></div>
<div class="section level4">
<h4 id="wei-lin-weissfeld-wlw-overall-effect">
<strong>Wei-Lin-Weissfeld (WLW) (overall effect)</strong><a class="anchor" aria-label="anchor" href="#wei-lin-weissfeld-wlw-overall-effect"></a>
</h4>
<p>Compared to other models in which events happen successively, the WLW
method is well suited to multi-type event data in which the <em>natural
order of the repeated events is no predictable</em>.</p>
<p>The WLW model tend to yield biased estimates in recurrent event
analyses (usually overestimation of the true effect) due to the strong
assumption that all patients are included in the risk set for each and
relapse stratum, allowing the effect on earlier events to affect
subsequent events.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wlw.relapses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">TSTOP</span>, <span class="va">STATUS</span><span class="op">)</span> <span class="op">~</span> <span class="op">(</span><span class="va">DISEASE_COURSE</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">TIME_SINCE_DIAGNOSIS</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">SEVENT</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data_layout_2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wlw.relapses</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(TSTOP, STATUS) ~ DISEASE_COURSE + AGE + </span></span>
<span><span class="co">#&gt;     SEX + RACE + TIME_SINCE_DIAGNOSIS + strata(SEVENT), data = data_layout_2, </span></span>
<span><span class="co">#&gt;     cluster = ID)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                            coef  exp(coef)   se(coef)  robust se       z</span></span>
<span><span class="co">#&gt; DISEASE_COURSESPMS   -0.2936479  0.7455390  0.0226855  0.0188054 -15.615</span></span>
<span><span class="co">#&gt; AGE                   0.0015116  1.0015127  0.0009128  0.0008701   1.737</span></span>
<span><span class="co">#&gt; SEXMale              -0.0009643  0.9990362  0.0179781  0.0161890  -0.060</span></span>
<span><span class="co">#&gt; RACEWhite             0.0552958  1.0568532  0.0313109  0.0308863   1.790</span></span>
<span><span class="co">#&gt; TIME_SINCE_DIAGNOSIS  0.0007236  1.0007239  0.0004167  0.0002441   2.965</span></span>
<span><span class="co">#&gt;                            p</span></span>
<span><span class="co">#&gt; DISEASE_COURSESPMS   &lt; 2e-16</span></span>
<span><span class="co">#&gt; AGE                  0.08234</span></span>
<span><span class="co">#&gt; SEXMale              0.95250</span></span>
<span><span class="co">#&gt; RACEWhite            0.07341</span></span>
<span><span class="co">#&gt; TIME_SINCE_DIAGNOSIS 0.00303</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test=232.6  on 5 df, p=&lt; 2.2e-16</span></span>
<span><span class="co">#&gt; n= 15756, number of events= 14501</span></span></code></pre></div>
<p>However, as we can see in this study, the WLW model may underestimate
the true effect of disease course in the risk of relapses in the SPMS
group.</p>
</div>
<div class="section level4">
<h4 id="lee-wei-amato-model-lwa">
<strong>Lee-Wei-Amato model (LWA)</strong><a class="anchor" aria-label="anchor" href="#lee-wei-amato-model-lwa"></a>
</h4>
<p>With difference to the WLW, the LWA has a common baseline hazard and
unrestricted risk set and it was developed with the aim to study
clustered data such as siblings. This model often provide bias estimates
effect because it allows a subject to be at risk for several events
simultaneously.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lwa.relapses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">TSTOP</span>, <span class="va">STATUS</span><span class="op">)</span> <span class="op">~</span> <span class="op">(</span><span class="va">DISEASE_COURSE</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">TIME_SINCE_DIAGNOSIS</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data_layout_2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lwa.relapses</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(TSTOP, STATUS) ~ DISEASE_COURSE + AGE + </span></span>
<span><span class="co">#&gt;     SEX + RACE + TIME_SINCE_DIAGNOSIS, data = data_layout_2, </span></span>
<span><span class="co">#&gt;     cluster = ID)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                            coef  exp(coef)   se(coef)  robust se       z</span></span>
<span><span class="co">#&gt; DISEASE_COURSESPMS   -0.2124480  0.8086023  0.0224830  0.0119610 -17.762</span></span>
<span><span class="co">#&gt; AGE                   0.0011858  1.0011865  0.0009147  0.0005862   2.023</span></span>
<span><span class="co">#&gt; SEXMale              -0.0082235  0.9918102  0.0179757  0.0106347  -0.773</span></span>
<span><span class="co">#&gt; RACEWhite             0.0476025  1.0487537  0.0312979  0.0210217   2.264</span></span>
<span><span class="co">#&gt; TIME_SINCE_DIAGNOSIS  0.0003828  1.0003828  0.0004138  0.0001327   2.884</span></span>
<span><span class="co">#&gt;                            p</span></span>
<span><span class="co">#&gt; DISEASE_COURSESPMS   &lt; 2e-16</span></span>
<span><span class="co">#&gt; AGE                  0.04307</span></span>
<span><span class="co">#&gt; SEXMale              0.43936</span></span>
<span><span class="co">#&gt; RACEWhite            0.02355</span></span>
<span><span class="co">#&gt; TIME_SINCE_DIAGNOSIS 0.00393</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test=126  on 5 df, p=&lt; 2.2e-16</span></span>
<span><span class="co">#&gt; n= 15756, number of events= 14501</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="lin-wei-yang-ying-lwyy">
<strong>Lin-Wei-Yang-Ying (LWYY)</strong><a class="anchor" aria-label="anchor" href="#lin-wei-yang-ying-lwyy"></a>
</h4>
<p>LWYY can be seen as analogue to the AG model, but with less stronger
assumptions as it allows arbitrary dependence structure between
recurrent events and a varying rate function over time. This and the NB
model are one of the most used rate-based models for recurrent event
analyses in absence of terminal events or with negligible mortality in
clinical trial designs.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lwyy.relapses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">TSTART</span>, <span class="va">TSTOP</span>, <span class="va">STATUS</span><span class="op">)</span> <span class="op">~</span> <span class="va">DISEASE_COURSE</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">TIME_SINCE_DIAGNOSIS</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/cluster.html" class="external-link">cluster</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data_layout_1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lwyy.relapses</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; coxph(formula = Surv(TSTART, TSTOP, STATUS) ~ DISEASE_COURSE + </span></span>
<span><span class="co">#&gt;     AGE + SEX + RACE + TIME_SINCE_DIAGNOSIS, data = data_layout_1, </span></span>
<span><span class="co">#&gt;     cluster = ID)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                            coef  exp(coef)   se(coef)  robust se       z</span></span>
<span><span class="co">#&gt; DISEASE_COURSESPMS   -0.5718587  0.5644753  0.0403615  0.0279727 -20.443</span></span>
<span><span class="co">#&gt; AGE                   0.0028656  1.0028697  0.0015249  0.0013003   2.204</span></span>
<span><span class="co">#&gt; SEXMale              -0.0203516  0.9798541  0.0305203  0.0248691  -0.818</span></span>
<span><span class="co">#&gt; RACEWhite             0.1109051  1.1172889  0.0525239  0.0489264   2.267</span></span>
<span><span class="co">#&gt; TIME_SINCE_DIAGNOSIS  0.0011352  1.0011358  0.0007586  0.0003872   2.932</span></span>
<span><span class="co">#&gt;                            p</span></span>
<span><span class="co">#&gt; DISEASE_COURSESPMS   &lt; 2e-16</span></span>
<span><span class="co">#&gt; AGE                  0.02754</span></span>
<span><span class="co">#&gt; SEXMale              0.41316</span></span>
<span><span class="co">#&gt; RACEWhite            0.02340</span></span>
<span><span class="co">#&gt; TIME_SINCE_DIAGNOSIS 0.00337</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test=290.9  on 5 df, p=&lt; 2.2e-16</span></span>
<span><span class="co">#&gt; n= 6347, number of events= 5092</span></span></code></pre></div>
<p>Even though the AG (with robust SE) and LWYY have similar numerical
values without time dependant covariates, they model different ratios
(AG models intensity function and the marginal rates model models rate
of events). In this example, by partially considering the dependency
structure, the LWYY model estimated a similar risk reduction than the AG
model of 44% (RR: 0.57) in the SPMS group compared to RRMS.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Herman, Quentin Pilard.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
