<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>05. Count-based models in recurrent events • revents</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="05. Count-based models in recurrent events">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">revents</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://gitlab.par.quinten.io/d.herman/revents"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>05. Count-based models in recurrent events</h1>
                        <h4 data-toc-skip class="author">David
Herman</h4>
            
      

      <div class="d-none name"><code>count_based_models.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>warning <span class="op">=</span> <span class="cn">FALSE</span>, message <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://davidherman94.github.io/revents/">revents</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load data layout corresponding to the third layout</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"data_layout_3"</span>, package <span class="op">=</span> <span class="st">"revents"</span><span class="op">)</span></span>
<span><span class="va">data_layout_3</span> <span class="op">&lt;-</span> <span class="fu">revents</span><span class="fu">::</span><span class="va"><a href="../reference/data_layout_3.html">data_layout_3</a></span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set scientific notation to FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="poisson-regression">
<strong>Poisson regression</strong><a class="anchor" aria-label="anchor" href="#poisson-regression"></a>
</h4>
<p>The Poisson model can be used as baseline model for recurrent events
data. However, the Poisson model assumes that the mean and the variance
are equal, which is not always the case in recurrent events data and
does not account for dependence between events and event timing.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poisson.relapses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">COUNT</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">LENGHT.TIME</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">DISEASE_COURSE</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span>  <span class="va">RACE</span> <span class="op">+</span> <span class="va">TIME_SINCE_DIAGNOSIS</span>, </span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, </span>
<span>  data <span class="op">=</span> <span class="va">data_layout_3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">poisson.relapses</span>, exp <span class="op">=</span> <span class="cn">TRUE</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   term                 estimate std.error statistic  p.value conf.low conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept)             0.376  0.076<span style="text-decoration: underline;">0</span>     -<span style="color: #BB0000;">12.9</span>   7.10<span style="color: #949494;">e</span><span style="color: #BB0000;">-38</span>    0.324     0.436</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> DISEASE_COURSESPMS      0.564  0.040<span style="text-decoration: underline;">4</span>     -<span style="color: #BB0000;">14.2</span>   1.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-45</span>    0.521     0.611</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> AGE                     1.00   0.001<span style="text-decoration: underline;">52</span>      1.88  6.02<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>    1.00      1.01 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> SEXMale                 0.980  0.030<span style="text-decoration: underline;">5</span>      -<span style="color: #BB0000;">0.667</span> 5.05<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>    0.923     1.04 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> RACEWhite               1.12   0.052<span style="text-decoration: underline;">5</span>       2.11  3.47<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>    1.01      1.24 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> TIME_SINCE_DIAGNOSIS    1.00   0.000<span style="text-decoration: underline;">759</span>     1.50  1.35<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>    1.00      1.00</span></span></code></pre></div>
<p>In a standard Poisson regression model, the mean and the variance are
assumed to be equal. For calculating the <em>underdispersion or
overdispersion ratio</em>, we need to calculate the residual deviance
and the residual degrees of freedom. This ratio is calculated as the
ratio of the residual deviance to the residual degrees of freedom.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the residual degrees of freedom</span></span>
<span><span class="va">residual_deviance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance</a></span><span class="op">(</span><span class="va">poisson.relapses</span><span class="op">)</span></span>
<span><span class="va">residual_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html" class="external-link">df.residual</a></span><span class="op">(</span><span class="va">poisson.relapses</span><span class="op">)</span></span>
<span></span>
<span> <span class="co"># Calculate the ratio</span></span>
<span><span class="va">over.under.dispersion_ratio</span> <span class="op">&lt;-</span> <span class="va">residual_deviance</span> <span class="op">/</span> <span class="va">residual_df</span></span>
<span><span class="va">over.under.dispersion_ratio</span></span>
<span><span class="co">#&gt; [1] 0.6508522</span></span></code></pre></div>
<p>As the dispersion ratio is different from 1, the Poisson model is not
recommended. However, the quasi-Poisson model corrects for under or
overdispersion by incorporating a dispersion parameter that scales the
variance, providing more accurate estimates.</p>
</div>
<div class="section level4">
<h4 id="quassi-poisson-model">
<strong>Quassi-poisson model</strong><a class="anchor" aria-label="anchor" href="#quassi-poisson-model"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qpoisson.relapses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">COUNT</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">LENGHT.TIME</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">DISEASE_COURSE</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">TIME_SINCE_DIAGNOSIS</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data_layout_3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">qpoisson.relapses</span>, exp <span class="op">=</span> <span class="cn">TRUE</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   term                 estimate std.error statistic  p.value conf.low conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept)             0.376  0.060<span style="text-decoration: underline;">5</span>     -<span style="color: #BB0000;">16.2</span>   8.49<span style="color: #949494;">e</span><span style="color: #BB0000;">-54</span>    0.334     0.423</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> DISEASE_COURSESPMS      0.564  0.032<span style="text-decoration: underline;">1</span>     -<span style="color: #BB0000;">17.8</span>   9.72<span style="color: #949494;">e</span><span style="color: #BB0000;">-64</span>    0.530     0.601</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> AGE                     1.00   0.001<span style="text-decoration: underline;">21</span>      2.36  1.83<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>    1.00      1.01 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> SEXMale                 0.980  0.024<span style="text-decoration: underline;">3</span>      -<span style="color: #BB0000;">0.839</span> 4.02<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>    0.934     1.03 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> RACEWhite               1.12   0.041<span style="text-decoration: underline;">8</span>       2.66  8.02<span style="color: #949494;">e</span><span style="color: #BB0000;">- 3</span>    1.03      1.21 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> TIME_SINCE_DIAGNOSIS    1.00   0.000<span style="text-decoration: underline;">603</span>     1.88  6.01<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>    1.00      1.00</span></span></code></pre></div>
<p>Although the estimated coefficients are similar to the Poisson model,
the quasi-Poisson model provides more accurate estimates by accounting
for underspersion. These differences can be found in the 95% CI of the
coefficients.</p>
</div>
<div class="section level4">
<h4 id="negative-binomial-model">
<strong>Negative Binomial model</strong><a class="anchor" aria-label="anchor" href="#negative-binomial-model"></a>
</h4>
<p>The NB regression provides an improved model for recurrent events
data compared with Poisson regression as this model assumes that each
individual has their own underlying event rate over time and also may
include a random component for accounting subject heterogeneity.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nb.relapses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html" class="external-link">glm.nb</a></span><span class="op">(</span></span>
<span>  <span class="va">COUNT</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">LENGHT.TIME</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">DISEASE_COURSE</span> <span class="op">+</span> <span class="va">AGE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">TIME_SINCE_DIAGNOSIS</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data_layout_3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">nb.relapses</span>, exp <span class="op">=</span> <span class="cn">TRUE</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   term                 estimate std.error statistic  p.value conf.low conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept)             0.376  0.076<span style="text-decoration: underline;">0</span>     -<span style="color: #BB0000;">12.9</span>   7.13<span style="color: #949494;">e</span><span style="color: #BB0000;">-38</span>    0.324     0.436</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> DISEASE_COURSESPMS      0.564  0.040<span style="text-decoration: underline;">4</span>     -<span style="color: #BB0000;">14.2</span>   1.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-45</span>    0.521     0.611</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> AGE                     1.00   0.001<span style="text-decoration: underline;">52</span>      1.88  6.02<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>    1.00      1.01 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> SEXMale                 0.980  0.030<span style="text-decoration: underline;">5</span>      -<span style="color: #BB0000;">0.667</span> 5.05<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>    0.923     1.04 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> RACEWhite               1.12   0.052<span style="text-decoration: underline;">5</span>       2.11  3.47<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>    1.01      1.24 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> TIME_SINCE_DIAGNOSIS    1.00   0.000<span style="text-decoration: underline;">759</span>     1.50  1.35<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>    1.00      1.00</span></span></code></pre></div>
<p>In this study, with constant relapse rate (see <a href="C:/Users/david/revents/docs/articles/descriptive_analyses.html">descriptive
analyses</a>), the use of NB model can be accurate and recommended also
for its ability to account for over or underdispersion and
heterogeneity. However, the NB model does not consider event timing.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Herman, Quentin Pilard.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
